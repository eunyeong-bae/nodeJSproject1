<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="/main.css" rel="stylesheet"/>
</head>
<body class="grey-bg">
    <!-- %- : include ë¬¸ë²• ì‚¬ìš©í•  ë•Œ or ì‚¬ìš©í•˜ë©´ html ì´ ë Œë”ë§ë˜ì–´ ë‚˜ì˜´ -->
    <%- include('nav.ejs') %>
    <!-- <%= JSON.stringify(posts) %> -->

    <!-- 1.form íƒœê·¸ë¡œ ìš”ì²­í•˜ê¸° -->
    <!-- <form class="search-bg" action="/search" method="POST">
        <input class="search" type="text" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" name="search"/>
        <button class="search-send" type="submit">ê²€ìƒ‰</button>
    </form> -->
    
    <!-- 2.script ë¡œ ìš”ì²­í•˜ê¸° -->
    <input class="search" type="text" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" name="search"/>
    <button class="search-send" type="submit">ê²€ìƒ‰</button>
    
    <script>
        document.querySelector('.search-send').addEventListener('click', function(){
            let val = document.querySelector('.search').value;
            location.href = '/search?search='+val;
        })
    </script>    

    <div class="white-bg">
        <!-- % : html ì‚¬ì´ì— js ë¬¸ë²• ì“¸ ë•Œ -->
        <% for(let i=0; i<posts.length; i++){ %>
            <div class="list-box">
                <!-- %= : ì‚¬ìš©í•˜ë©´ html ì´ ë¬¸ìì²˜ëŸ¼ ë‚˜ì˜´ -->
                <h4>
                    <a href="/detail/<%= posts[i]._id %>">
                        <%= posts[i].title %>
                    </a> 
                    <a href="/edit/<%= posts[i]._id %>">âœï¸</a>
                    <span class="delete" data-id="<%= posts[i]._id %>">ğŸ—‘ï¸</span>
                </h4>
                <p><%= posts[i].content %></p>
            </div>

        <% } %>
        <!-- <a href="/list/next/<%= posts[posts.length - 1]._id %>">ë‹¤ìŒ</a> -->
    </div>

    <script>
        for(let i =0; i< '<%= posts.length %>' ; i++){
            document.querySelectorAll('.delete')[i]
            .addEventListener('click', function(e) {
                const id = e.target.dataset.id;

                //ì„œë²„ì— ì‚­ì œìš”ì²­ ë‚ ë¦¬ê¸°
                fetch(`/delete?docId=${id}`, {
                    method: 'DELETE',
                })
                .then((r) => r.text())
                .then((r) =>
                    e.target.parentElement.parentElement.style.display = 'none'
                )
            })
        }
    </script>
</body>
</html>